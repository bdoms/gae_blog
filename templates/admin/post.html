<%inherit file="base.html"/>

<h3>
    Post
    % if post and post.published:
        (<a href="${blog_url}/post/${post.slug}">View</a>)
    % endif
</h3>

% if post:
    <form id="delete-form" action="${blog_url}/admin/posts" method="post">
        <input type="hidden" name="post" value="${post.key()}"/>
        <p><input type="submit" value="Delete This Post"/></p>
    </form>
% endif

<form action="" method="post">
    <p>
        <label for="title">Title:</label>
        <input type="text" name="title" value="${post and post.title or ''}" />
    </p>

    <p>
        <label for="author">Author:</label>
        <select name="author">
            % for author in authors:
                <option value="${author.key()}">${author.name}</a>
            % endfor
        </select>
    </p> 

    <p>
        <label for="body">Body:</label>
        <span class="help">(use HTML formatting here)</span>
    </p>
    % if post:
        <textarea name="body">${post.body}</textarea>        
    % else:
        <textarea name="body"></textarea>
    % endif

    <p>
        <label for="timestamp-choice">Timestamp:</label>
        <span class="help">(make a future timestamp and check published to schedule for later)</span>
    </p>
    <ul>
        <li>
            % if post:
                <input type="radio" id="timestamp-now" name="timestamp-choice" value="now" />
            % else:
                <input type="radio" id="timestamp-now" name="timestamp-choice" value="now" checked="checked" />
            % endif
            <label for="timestamp-now">Now</label>
        </li>
        <li>
            % if post:
                <input type="radio" id="timestamp-custom" name="timestamp-choice" value="custom" checked="checked" />
            % else:
                <input type="radio" id="timestamp-custom" name="timestamp-choice" value="custom" />
            % endif
            <label for="timestamp-custom">Custom:</label>
            <input type="text" name="timestamp" value="${post and post.timestamp.strftime('%Y-%m-%d %H:%M:%S') or ''}" />
            <span class="help">(ex: 1970-01-21 13:35:16)</span>
        </li>
    </ul>

    <p>
        <label for="published-box">Published:</label>
        % if post and post.published:
            <input type="checkbox" name="published" checked="checked" id="published-box" />
        % else:
            <input type="checkbox" name="published" id="published-box" />
        % endif
    </p>

    % if post and post.published:
        <p id="preview-button" style="display: none;">
    % else:
        <p id="preview-button">
    % endif
        <input type="submit" value="Save and Preview" name="preview" />
        <span class="help">(you can only preview unpublished posts)</span>
    </p>

    <p><input type="submit" value="Save and Stop Working" /></p>
</form>

<script type="text/javascript">
    % if post:
        var delete_form = document.getElementById("delete-form");
        delete_form.addEventListener("submit", function(e) {
            var response = confirm("Are you sure you want to permanently delete this post and all its comments?\n\nAny links to it will be broken.");
            if (!response) {
                if (e.stopPropagation) e.stopPropagation();
                else e.cancelBubble = true;

                if (e.preventDefault) e.preventDefault();
                else e.returnValue = false;

                return false;
            }
        }, false);
    % endif

    var published_box = document.getElementById("published-box");
    published_box.addEventListener("click", function(e) {
        var preview_button = document.getElementById("preview-button");
        if (this.checked) {
            preview_button.style.display = "none";
        }
        else {
            preview_button.style.display = "block";
        }
        return false;
    }, false);
</script>

